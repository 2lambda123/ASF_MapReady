# This make file lists all the system components used by the latest
# tools in one flat list, making no attempt to sort out the build
# order automatically.

# Note that the order in which the modules are listed is critical!
# Note also that this simplistic build scheme takes the traditional
# built-too-much approach: building the default target all will
# rebuild everything.  So if you want to be sure all the prerequisite
# to your tool are rebuilt, you should do a make all.  On the other
# hand, if you want to rebuild just the module you are working on,
# just do a make in that subdirectory.

include make_support/system_rules

MODULES = \
	src/asf \
	src/libasf_proj \
	src/libasf_ardop \
	src/asf_meta \
	src/asf_fft \
	src/libasf_raster \
	src/libasf_vector \
	src/libasf_sar \
	src/ardop \
	src/libasf_import \
	src/libasf_geocode \
	src/libasf_export \
	src/libasf_terrcorr \
	src/libasf_insar \
	src/asf_import \
	src/asf_export \
	src/asf_geocode \
	src/asf_terrcorr \
	src/libasf_convert \
	src/asf_convert \
	src/refine_geolocation \
	src/sr2gr \
	src/gr2sr \
	src/metadata \
	src/meta2envi \
	src/mosaic \
	@ASF_GUI@
# src_x/sarview

S_SHAREDIR := $(shell echo "$(SHAREDIR)" | perl -p -i -e 's/\.\.\/\.\.\///')
S_BINDIR := $(shell echo "$(BINDIR)" | perl -p -i -e 's/\.\.\/\.\.\///')

all: external_libs
	mkdir -p $(S_BINDIR) $(S_SHAREDIR) lib
	cp LICENSE.txt $(S_SHAREDIR)
	$(foreach MODULE, $(MODULES), $(MAKE) -C $(MODULE) &&) true
	@ echo ""
	@ echo "  XXXXXXXXXXXX All ASF Tools Compiled Successfully! XXXXXXXXXXX"
	@ echo ""

install: all
	mkdir -p @BINDIR@ @prefix@/lib @SHAREDIR@
	cp -R $(S_BINDIR)/* @BINDIR@
	cp -R lib/* @prefix@/lib
	cp -R $(S_SHAREDIR)/* @SHAREDIR@
	chmod 755 @BINDIR@/*
	chmod -R a+r @SHAREDIR@/*
	chmod a+x @SHAREDIR@/projections
	chmod a+x @SHAREDIR@/projections/*
	chmod a+x @SHAREDIR@/asf_convert
	chmod a+x @SHAREDIR@/proj

external_libs:
	mkdir -p $(S_BINDIR) $(S_SHAREDIR) lib
	$(MAKE) -C external
	-cp -R external/lib/* lib
	-chmod -R ug+w lib
	-cp -R external/include/* include
	-chmod -R ug+w include
	-cp -R external/share/* share/asf_tools
	-chmod -R ug+w share

clean:
	rm -rf bin/* lib/* share/*

release:
	cd make_support; $(MAKE); ./makemake @sys@; cd ..

oldtools:
	cd make_support; $(MAKE); ./makemake @sys@; cd ..
	$(MAKE) --makefile=Makefile.old
