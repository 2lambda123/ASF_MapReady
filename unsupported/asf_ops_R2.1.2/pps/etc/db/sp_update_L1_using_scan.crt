/*************************************************************************
 * Copyright(c) 1996, California Institute of Technology.                *
 *             ALL RIGHTS RESERVED.                                      *
 * U.S. Government Sponsorship acknowledged.                             *
 *************************************************************************/
/*=======================
	@(#)sp_update_L1_using_scan.crt	1.4  03/11/97
=========================*/

if exists (select * from sysobjects where name = "sp_update_L1_using_scan")
	drop proc sp_update_L1_using_scan
go

create proc sp_update_L1_using_scan 
	(@L1_job_id         int, 
	 @scan_job_id       int,
	 @cal_params_file1  varchar(40),
	 @cal_params_file2  varchar(40),
	 @scan_results_file varchar(255),
	 @station_id        StationIdType,
	 @start_time 	    TimeType,
	 @end_time          TimeType,
	 @center_time       TimeType,
	 @data_direction    DataDirectionType)
as

begin transaction

	update L1_procparms
	set 
		sv_coord_sys	= s.sv_coord_sys,
                sv_type		= s.sv_type,
                sv_rev         	= s.sv_rev,
                sv_time        	= s.sv_time,
                sv_x_pos       	= s.sv_x_pos,
                sv_y_pos       	= s.sv_y_pos,
                sv_z_pos       	= s.sv_z_pos,
                sv_x_velocity  	= s.sv_x_velocity,
                sv_y_velocity  	= s.sv_y_velocity,
                sv_z_velocity  	= s.sv_z_velocity,
                gha_time       	= s.gha_time,
                gha_angle      	= s.gha_angle,
                tce_rev        	= s.tce_rev,
                tce_time       	= s.tce_time,
                tce_sat_time   	= s.tce_sat_time,
                tce_clock_cycle = s.tce_clock_cycle,
		media_type	= s.media_type,
		media_id	= s.media_id,
		media_location	= s.media_location,
		recorder_id     = s.recorder_id,
		start_time	= @start_time,
		end_time	= @end_time,
		center_time     = @center_time,
		station_id	= @station_id,
		data_direction  = @data_direction,
		cal_params_file = @cal_params_file1,
		cal_params_file2= @cal_params_file2,
		scan_results_file = @scan_results_file
	from L1_procparms l , scan_orders s
	where l.job_id = @L1_job_id
	and   s.job_id = @scan_job_id

        if (@@transtate > 0)
	begin
                rollback transaction
		return -1
	end

        update ppsgui_orders 
        set
                media_type      = s.media_type,
                media_id        = s.media_id,
                media_location  = s.media_location,
                station_id      = @station_id,
		data_direction  = s.data_direction
        from ppsgui_orders g , scan_orders s
        where g.job_id = @L1_job_id
        and   s.job_id = @scan_job_id

        if (@@transtate > 0)
        begin
                rollback transaction
                return -1
        end

commit transaction

return 0 
go
