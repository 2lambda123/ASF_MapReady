/*************************************************************************
 * Copyright(c) 1996, California Institute of Technology.                *
 *             ALL RIGHTS RESERVED.                                      *
 * U.S. Government Sponsorship acknowledged.                             *
 *************************************************************************/

/*=======================
	@(#)sp_plan_available_remove.crt	1.1  11/21/96
=========================*/

/* stored procedure to remove a job from the schedule - jtg */

if exists (select * from sysobjects where name = "sp_plan_available_remove")
	drop procedure sp_plan_available_remove
go

create proc sp_plan_available_remove
		@job_id int
	as

	/* begin transaction */
	begin transaction

	/* update job_state in the jobs table */
	update jobs
		set job_state = "READY",
		    state_date = getdate()	
                where job_id = @job_id

	if (@@transtate > 0)
	begin
		rollback transaction
		return -1
	end

	/* update job_state in the ppsgui_orders table */
	update ppsgui_orders
		set job_state = "READY",
		    state_date = getdate()
                where job_id = @job_id

	if (@@transtate > 0)
	begin
		rollback transaction
		return -1
	end

	/* delete job from the schedule table */
	delete schedule
                where job_id = @job_id

	if (@@transtate > 0)
	begin
		rollback transaction
		return -1
	end


	/* commit transaction */
	commit transaction

go
