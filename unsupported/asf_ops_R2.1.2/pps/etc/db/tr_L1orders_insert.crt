/*************************************************************************
 * Copyright(c) 1996, California Institute of Technology.                *
 *             ALL RIGHTS RESERVED.                                      *
 * U.S. Government Sponsorship acknowledged.                             *
 *************************************************************************/
/*=======================
	@(#)tr_L1orders_insert.crt	1.2  03/11/97
=========================*/

if exists (select * from sysobjects where name = "tr_L1orders_insert")
        drop trigger tr_L1orders_insert
go

create trigger tr_L1orders_insert
	on L1_orders
	for insert
as

	declare @num_rows int
	declare @job_type char(15)
	select @num_rows = count(*) from inserted

	if @num_rows = 0
		return

	/* if another similar order does not exists, 
	 * the insert trigger on Jobs table will insert an entry
	 * for this order into ppsgui_orders table.
	 * if another similar order does exists, 
	 * then the trigger on jobs table will not be invoked,
	 * enter an entry for this new order.
	 */

	if not exists ( select * 
			from inserted, ppsgui_orders
			where inserted.job_id = ppsgui_orders.job_id )
		return

	insert into ppsgui_orders
		(
		job_id, 
		job_state, 
		job_type,
		priority, 
		quicklook_flag, 
		insert_top_flag, 
		state_date,
        	media_id, 
		mode,
        	platform, 
		sensor, 
		rev,
        	order_id, 
		item_id,
        	sequence, 
        	media_type, 
		media_location,
		pixel_spacing,
		prod_time,
		activity_id,
		station_id,
		product_type,
		projection,
		processing_gain,
		deskew_flag,
		output_format,
		frame_id,
		subframe_id,
		data_direction,
		compensation_flag
		)
		select
		i.job_id, 
		j.job_state, 
		j.job_type,
		j.priority, 
		j.quicklook_flag, 
		j.insert_top_flag, 
		j.state_date,
        	p.media_id, 
		p.mode,
        	p.platform, 
		p.sensor, 
		p.rev,
        	i.order_id, 
		i.item_id,
        	p.sequence, 
        	p.media_type, 
		p.media_location,
		p.pixel_spacing,
		0,
		p.activity_id,
		p.station_id,
		p.product_type,
		p.projection,
		p.processing_gain,
		p.deskew,
		p.output_format,
		p.frame_id,
		p.subframe_id,
		p.data_direction,
		p.compensation_flag
		from 
			inserted i, L1_procparms p, jobs j
		where 
			i.job_id = j.job_id
			and   p.job_id = i.job_id


return
go
