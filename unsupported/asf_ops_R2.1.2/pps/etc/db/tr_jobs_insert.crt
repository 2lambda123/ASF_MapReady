/*************************************************************************
 * Copyright(c) 1996, California Institute of Technology.                *
 *             ALL RIGHTS RESERVED.                                      *
 * U.S. Government Sponsorship acknowledged.                             *
 *************************************************************************/
/*=======================
	@(#)tr_jobs_insert.crt	1.2  03/11/97
=========================*/

if exists (select * from sysobjects where name = "tr_jobs_insert")
        drop trigger tr_jobs_insert
go

create trigger tr_jobs_insert
	on jobs
	for insert
as

	declare @num_rows int
	declare @job_type char(15)
	select @num_rows = count(*) from inserted

	if @num_rows = 0
		return

	insert into ppsgui_orders
		(
		job_id, job_state, job_type,
		priority, quicklook_flag, insert_top_flag, state_date
		)
		select
		job_id, job_state, job_type, 
		priority, quicklook_flag, insert_top_flag, state_date
		from 
		inserted

	select @job_type = job_type
		from inserted

	if @job_type = "L1"
		update ppsgui_orders
			set
        		p.media_id = pp.media_id, 
			p.mode = pp.mode,
        		p.platform = pp.platform, 
			p.sensor = pp.sensor, 
			p.rev = pp.rev,
        		p.order_id = l.order_id, 
			p.item_id = l.item_id,
        		p.sequence = pp.sequence, 
        		p.media_type = pp.media_type, 
			p.media_location = pp.media_location,
			p.pixel_spacing = pp.pixel_spacing,
			p.prod_time = 0,
			p.activity_id = pp.activity_id,
			p.station_id = pp.station_id,
			p.product_type = pp.product_type,
			p.projection = pp.projection,
			p.processing_gain = pp.processing_gain,
			p.deskew_flag = pp.deskew,
			p.output_format = pp.output_format,
			p.frame_id = pp.frame_id,
			p.subframe_id = pp.subframe_id,
			p.data_direction = pp.data_direction,
			p.compensation_flag = pp.compensation_flag
			from 
			inserted i, ppsgui_orders p, 
			L1_orders l, L1_procparms pp
			where 
				i.job_id = l.job_id
				and   p.job_id = i.job_id
				and   p.job_id = pp.job_id

	if @job_type = "SCAN"
		update ppsgui_orders
			set
        		p.media_id = s.media_id, 
			p.mode = s.mode,
        		p.platform = s.platform, 
			p.sensor = s.sensor, 
			p.rev = s.rev,
        		p.order_id = s.order_id, 
			p.item_id = s.item_id,
        		p.sequence = s.sequence, 
        		p.media_type = s.media_type, 
			p.media_location = s.media_location,
			p.activity_id = s.activity_id,
			p.station_id = s.station_id,
			p.data_direction = s.data_direction
			from 
			inserted i, ppsgui_orders p, scan_orders s
			where 
				i.job_id = s.job_id
				and   p.job_id = i.job_id

return
go
